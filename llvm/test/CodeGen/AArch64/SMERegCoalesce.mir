# RUN: llc -mattr=+sme -mtriple=aarch64-none-linux-gnu -stop-after=simple-register-coalescing  %s -o - | FileCheck %s
--- |
  define void @smeregcoalesce() { entry: unreachable }
...

name: smeregcoalesce
alignment: 4
tracksRegLiveness: true
body: |

  bb.0.entry:
    successors: %bb.1(0x80000000)

    ; CHECK-LABEL: smeregcoalesce
    ; CHECK: ZERO_M
    ; CHECK-NEXT: ZERO_M
    ; CHECK-NOT: SMECOPY_W
    ; CHECK: bb.1:
    ; CHECK-NEXT: SMECOPY_W
    ; CHECK-NEXT: SMECOPY_W
    ; Goal here is to coalesce the copies. The copy stored in reg %6 and %10 are redudant and can be coalesced.
    ; so in bb.1 %14 and %18 directly copy from %0 and %1 respectively

    %1:mpr32 = ZERO_M
    %2:mpr32 = ZERO_M 
    %3:gpr64common = COPY $xzr
    %4:zpr = IMPLICIT_DEF
    %5:ppr = IMPLICIT_DEF
    %6:matrixindexgpr32_12_15 = IMPLICIT_DEF
    %7:mpr32 = SMECOPY_W %1, %4, %5, %6
    %8:zpr = IMPLICIT_DEF
    %9:ppr = IMPLICIT_DEF
    %10:matrixindexgpr32_12_15 = IMPLICIT_DEF
    %11:mpr32 = SMECOPY_W %2, %8, %9, %10

  bb.1:
    %12:zpr = IMPLICIT_DEF
    %13:ppr = IMPLICIT_DEF
    %14:matrixindexgpr32_12_15 = IMPLICIT_DEF
    %15:mpr32 = SMECOPY_W %11, %12, %13, %14
    %16:zpr = IMPLICIT_DEF
    %17:ppr = IMPLICIT_DEF
    %18:matrixindexgpr32_12_15 = IMPLICIT_DEF
    %19:mpr32 = SMECOPY_W %7, %16, %17, %18
    %20:gpr64 = COPY $xzr
...
